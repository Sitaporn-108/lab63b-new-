# การทดลองที่ 1 เรื่อง การเขียนโปรแกรมเพื่อรันบนไมโครคอนโทรเลอร์

##  วัตถุประสงค์
  1. เพื่อศึกษาการทำงานของ ไมโครคอนโทรเลอร์
  2. เพื่อศึกษาการทำงานของ platformio
  3. เพื่อศึกษาการรันโปรแกรมใน platformio
  4. เพื่อศึกษาการอัพโหลดโปรแกรมเข้า ไมโครคอนโทรเลอร์
  
##  อุปกรณ์ที่ใช้ (รายการอุปกรณ์)
  1. ไมโครคอนโทรเลอร์ ชื่อ ESP-01 ประกอบด้วย CPU และเสาอากาศสำหรับ WIFI
  2. อุปกรณ์ต่อ USB เพื่อไปยัง serial

##  ศึกษาข้อมูลเบื้องต้น (แหล่งข้อมูลเพื่อการศึกษา)
    https://youtu.be/NLIUsWLEpmg

##  วิธีการทำการทดลอง
  1. เขียนโปรแกรมลงในไมโครคอนโทรเลอร์ โดยการเสียบไมโครคอนโทรเลอร์เข้าทาง serial port
  2. เข้าไปดูตัวอย่างโปรแกรม ในโฟลเดอร์ pattani
      - พิมพ์ **cd pattani** เพื่อเข้าสู่โฟลเดอร์
      - พิมพ์ **cd 01_Serial-Monitor** *Enter* และ **vi src/main.cpp** เพื่อเข้าสู่ตัวอย่างที่ 1 จาก 9 ตัวอย่าง
      ![image](https://user-images.githubusercontent.com/80879429/112097457-a30f1600-8bd2-11eb-88e4-cbac8f414bb3.jpg)
      - อ่านข้อมูลรายละเอียดของโปรแกรม
      ![image](https://user-images.githubusercontent.com/80879429/112097638-f84b2780-8bd2-11eb-9a2d-d2e3cc8a6ab2.jpg)
      - พิมพ์ **:q** เพื่อออกจากตัวอย่างที่ 1
      - *เนื้อหารายละเอียดของโปรแกรมที่แสดงใน platformio*
```javascript
#include <Arduino.h>

int cnt = 0;

void setup()
{
	Serial.begin(115200);
}

void loop()
{
	cnt++;
	Serial.printf("PATTANI :%d\n",cnt);
	delay(1000);
}
© 2021 GitHub, Inc.
```
  3. ในแต่ละโปรแกรม จะมี configuration file
      - พิมพ์ **vi platformio.ini** เพื่อเข้าสู่ configuration file ของโปรแกรม
      ![image](https://user-images.githubusercontent.com/80879429/112097678-06994380-8bd3-11eb-8312-ac04a47d448c.jpg)
        configuration file ของโปรแกรม จะบอกรายละเอียดต่างๆ ดังนี้
        * platform แสดงถึง เทคโนโลยีของบริษัทผู้ผลิต
        * board แสดงถึง ชื่อบอร์ด
        * framwork แสดงถึง วิธีการเขียนโปรแกรม
        * upload_port แสดงถึง portที่ใช้ติดต่อ  [ในกรณีนี้เป็น windows จึงแสดงว่า COM3 (หรือCOM4)]
      
      - พิมพ์ **:q** เพื่อออกจาก configuration file
  4. อัพโหลดโปรแกรม 01_Serial-Monitor เข้าไปยังไมโครคอนโทรเลอร์ 
      - พิมพ์ **pio run -t upload** เพื่ออัพโหลด
      ![image](https://user-images.githubusercontent.com/80879429/112097793-3c3e2c80-8bd3-11eb-996e-32ca2630c4d9.jpg)
      - ขณะที่โปรแกรมรัน ต้องกดปุ่มดำ(load)  และปุ่มแดง(reset) ที่ไมโครคอนโทรเลอร์ เพื่อรับโปรแกรมใหม่เข้าไป
      ![image](https://user-images.githubusercontent.com/80879429/112098051-b53d8400-8bd3-11eb-81a0-603bb97c49a6.png)
      - เมื่อรันโปรแกรมเสร็จเรียบร้อย
      ![image](https://user-images.githubusercontent.com/80879429/112096308-9db0cc00-8bd0-11eb-8e18-ad50c46ef244.png)
      - พิมพ์ **pio device monitor** เพื่อดูผลลัพธ์

##  การบันทึกผลการทดลอง
1. จากการรันตัวอย่างที่ 1 พบว่า จะแสดงผลข้อมูล รวม 15 บรรทัด แบ่งเป็น 2 ส่วน หรือ 2 ฟังก์ชัน เขียนด้วยภาษา C หรือ C+
	- ส่วนที่ 1 **void set up** รัน 1 ครั้ง โดยจะ set up serial port ที่ความเร็ว 115200
	- ส่วนที่ 2 **void loop** รันวนลูป ประกอบด้วย
		* **cnt++** คือ การเพิ่มตัวแปล count ขึ้นเรื่อยๆ
		* **Serial.printf("PATTANI :%d\n",cnt)** คือ การแสดงผลของ ตัวแปล count ออกมา 
		* **delay(1000)** หมายถึง ช่วงเวลา 1000 ms หรือเกิดการหน่วงเวลา  1 วินาที 
 2. จากการอัปโหลดโปรแกรมเข้าสู่ไมโครคอนโทรเลอร์ พบว่า ไมโครคอนโทรเลอร์สามารถรับโปรแกรมเข้าสู่ระบบ พร้อมกับสามารถแสดงผลได้อย่างปกติในคอมพิวเตอร์

##  อภิปรายผลการทดลอง
  * platformio นั้น สามารถใช้เขียนโปรแกรมจาก microcontroller หลายชนิดที่มีบริษัทต่างกันได้ โดย คำสั่ง platformio.ini เป็นเหมือนตัวแสดงผลว่าการเขียนโปรแกรมครั้งนี้เราจะเขียนให้กับ microcontroller ตัวไหน
  * pio run -t upload นั้นใช้ในการอัพโหลดข้อมูลไปยัง microcontroller โดยสามารถกดปุ่มซึ่งอยู่ภายนอก microcontroller เพื่อทำการโหลดและรีเซ็ตการรันโปรแกรมได้	

##  คำถามหลังการทดลอง
**คำถาม**   หากไม่กดปุ่มดำ หรือปุ่มแดง ขณะอัพโหลดโปรแกรมจะเกิดอะไรขึ้น และจงบอกวิธีการแก้ปัญหา
* **คำตอบ**   หากไม่กดปุ่ม จะทำให้ ไมโครคอนโทรเลอร์ไม่สามารถรับโปรแกรมได้ การอัพโหลดจะไม่สำเร็จ การแก้ปัญหา คือเริ่มต้มอัพโหลดใหม่
