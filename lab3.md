# การทดลองที่ 3 เรื่อง การเขียนโปรแกรมเอ้าพุทสัญญาณดิจิทัล

##  วัตถุประสงค์ (อธิบายเป็นข้อๆ)
   1. เพื่อศึกษาการเอ้าพุทสัญญาณสู่ภายนอก
   2. เพื่อศึกษษการทำงานของ Relay
   3. เพื่อศึกษาการต่อไมโครคอนโทรเลอร์ Adaptor รวมถึง Relay

##  อุปกรณ์ที่ใช้ (รายการอุปกรณ์)
   1. คอมพิวเตอร์ ESP-01 ประกอบด้วย Output-Port(หมายเลข 0) และ Input-Port(หมายเลข 1)
   2. Adaptor ที่มีสาย Port 0(สีขาว) และ Port 1(สีเหลือง) ซึ่งสายทั้งหมดต่อกับ LED 
   3. Relay ใช้ควบคุมการเปิดปิดสวิตซ์

##  ศึกษาข้อมูลเบื้องต้น (แหล่งข้อมูลเพื่อการศึกษา)
    https://youtu.be/CCnN1WJsXQY
    https://youtu.be/6JnhaUILGuw

##  วิธีการทำการทดลอง (ทำเป็นขั้นตอนพร้อมภาพประกอบ)
   1. นำ Adaptor เสียบเข้ากับ USB to Serial Port และจึงนำไมโครคอนโทรเลอร์มาเชื่อมต่อกับตัว Adaptor อีกที
   2. พิมพ์ข้อมูลเพื่อเข้าสู้โปรแกรม ตัวอย่างที่ 3
        -  platformio.ini src
        - พิมพ์ **pwd** และพิมพ์ **vi src/main.cpp** เพื่อเข้าสู่โปรแกรม
      ![image](https://user-images.githubusercontent.com/80879429/112171484-708f0880-8c26-11eb-8fa5-e79e93957616.png)      
   3. รายละเอียดของโปรแกรมมี 2 ส่วน 
        - ส่วนที่ 1 **void setup**  เตรียมการ set pinMode ให้ Port0 เป็น Output
        - ส่วนที่ 2 **void loop**   วนลูปทุกครึ่งวินาที โดยจะนับ count เพิ่มขึ้นเรื่อยๆ 
        - เมื่อค่า cnt เป็นเลขคู่ แสดงว่าส่งค่า 1 ไปที่ Port0 จะ **ON**
        - เมื่อค่า cnt เป็นเลขคี่ แสดงว่าส่งค่า 0 ไปที่ Port0 จะ **OFF**
        - พิมพ์ **:q** เพื่อออก
        - *เนื้อหารายละเอียดของโปรแกรมที่แสดงใน platformio*

```javascript
#include <Arduino.h>
#include <ESP8266WiFi.h>

int cnt = 0;

void setup()
{
	Serial.begin(115200);
	pinMode(0, OUTPUT);
	Serial.println("\n\n\n");
}

void loop()
{
	cnt++;
	if(cnt % 2) {
		Serial.println("========== ON ===========");
		digitalWrite(0, HIGH);
	} else {
		Serial.println("========== OFF ===========");
		digitalWrite(0, LOW);
	}
	delay(500);
}

© 2021 GitHub, Inc.
```
   ![image](https://user-images.githubusercontent.com/80879429/112171570-84d30580-8c26-11eb-81dc-e81b4b7e433f.png)
   4. การอัพโหลดโปรแกรมเข้าสู่ ไมโครคอนโทรเลอร์
        - พิมพ์ **pio run -t upload** เพื่ออัพโหลด
        - กดปุ่ม upload(ดำ) ค้างไว้ และกดปุ่ม reset(แดง) เพื่อให้โปรแกรมอัพโหลดได้
      ![image](https://user-images.githubusercontent.com/80879429/112171624-93212180-8c26-11eb-8225-65686bc7ce07.png)
   5. พิมพ์ **pio device monitor** เพื่อดูผลลัพธ์ของการรัน 
      ![image](https://user-images.githubusercontent.com/80879429/112171669-9f0ce380-8c26-11eb-86e5-fcb832635c99.png)
   6. นำไมโครคอนโทรเลอร์ที่ลงโปรแกรมรียบร้อยแล้วออกจาก Adaptor และนำมาต่อกับ Relay แทน เพื่อใช้ควบคุมการเปิดปิดสวิตซ์
   7. นำปลายสายของ Relay ซึ่งคือขั้ว USB มาเชื่อมกับ USB to Serial Port 5V เพื่อรับสัญญาณไฟเลี้ยง
      ![image](https://user-images.githubusercontent.com/80879429/112171730-ae8c2c80-8c26-11eb-9cb2-00b52f30aadd.png)
   8. ทำการสังเกตสิ่งที่เกิดขึ้นกับตัวรีเลย์

##  การบันทึกผลการทดลอง (พร้อมตัวอย่าง)
   * พบว่าทุกครึ่งวินาที โปรแกรมเกิดการสลับไปมาระหว่าง ON/OFF และหลอดLEDที่เชื่อมกับสาย Port 0(สีขาว)จะเกิดการเปลี่ยนแปลง ดังนี้ 
      - **หาก OFF ไฟที่หลอด LED : ไม่สว่าง** 
      - **หาก ON ไฟที่หลอด LED : สว่าง**
   * เมื่อนำไมโครคอนโทรเลอร์ที่เชื่อมรีเลย์มาต่อกับแหล่งจ่ายไฟ พบว่า จะเกิดเสียงที่เกิดจากหน้าสัมผัสของสวิตซ์ไฟบนรีเลย์ทำการเปิด-ปิด พร้อมกับเกิดการสว่าง-ดับของหลอดไฟบนรีเลย์เช่นกัน
      * ![image](https://user-images.githubusercontent.com/80879429/112172691-818c4980-8c27-11eb-8f3b-77eb1db63fc3.png)
      
      * ![image](https://user-images.githubusercontent.com/80879429/112172729-8a7d1b00-8c27-11eb-8b82-7d212fc3a8c7.png)
      
##  อภิปรายผลการทดลอง (พร้อมตัวอย่าง)
   * pio run -t upload นั้นใช้ในการอัพโหลดข้อมูลจาก 03_Output-Port ไปยัง microcontroller โดยคำสั่ง pio device monitor ที่ใช้ดูผลลัพธ์ของโปรแกรมที่ถูกอัพโหลดเข้าไป โดย output ที่ได้ออกมาจะสังเกตว่า ขึ้น on-off สลับกันไปในทุกๆ 500 ms
   * ในขณะเดียวกันหลอด LED เปล่งแสง ที่ port 0 ซึ่ง ติดและดับ ตามคำสั่ง on-off
   *  เมื่อนำ microcontroller ต่อเข้ากับ Relay จะสังเกตได้ว่า Relay มีลักษณะการเปิด-ปิดสวิตซ์สอดคล้องกับ code ของโปรแกรมที่เราใส่
##  คำถามหลังการทดลอง (พร้อมตัวอย่างคำตอบ)
**คำถาม**   ถ้าต้องการให้หลอด LED อีกตัว เกิดการสว่างจะต้องทำอย่างไร
*  **คำตอบ**   ทำการสลับขาของ LED ที่ต้องการให้สว่างเชื่อมกับสายสีขาว
